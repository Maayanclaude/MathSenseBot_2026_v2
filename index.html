<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>转-转:  转拽</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">
  
  <style>
    /* 注爪 驻转专 拽专驻 */
    .mic-btn {
        background-color: #4CAF50; border: none; color: white; padding: 0;
        text-align: center; text-decoration: none; display: flex; align-items: center;
        justify-content: center; font-size: 24px; cursor: pointer; border-radius: 50%;
        width: 45px; height: 45px; transition: background-color 0.3s;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-right: 5px; 
    }
    .mic-btn:hover { background-color: #45a049; }
    .mic-btn.recording { background-color: #ff4444; animation: pulse 1.5s infinite; }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
    }
    .input-area { display: flex; align-items: center; gap: 10px; padding: 10px; }
    #send-button { height: 45px; }
  </style>
</head>
<body>

  <div id="login-screen" class="login-screen">
      <div class="login-box">
          <img src="images/main title.png" alt="转-转" class="login-logo">
          <img src="images/subtitle.png" alt=" 住驻专" class="login-subtitle">
          <h2>专  拽专</h2>
          <p>  转 拽 砖转转祝 砖拽转:</p>
          <input type="text" id="participant-id-input" placeholder=": 101">
          <button id="login-btn" class="login-btn-style">住</button>
      </div>
  </div>

  <div id="welcome-screen" class="welcome-screen hidden">
    <div class="header-section">
        <img src="images/main title.png" alt="转-转" class="title-img">
        <img src="images/subtitle.png" alt=" 住驻专" class="subtitle-img">
    </div>
    <div class="visuals-container">
        <img src="images/road.png" alt="砖" class="road-img">
        <img src="MatiCharacter/Mati_ready.png" alt="转" class="mati-welcome">
    </div>
    <div class="btn-container">
        <button id="start-button" class="start-btn">/ 转!</button>
    </div>
  </div>

  <div id="app-main-container" class="app-main-container hidden">
    <div class="right-panel">
        <img id="large-avatar" src="MatiCharacter/Mati_inviting_action.png" alt="转" class="large-character">
    </div>
    <div class="left-panel">
        <div class="top-bar">
            <div class="stars-container">
                <img src="icons/star_empty.png" class="star" id="star-0">
                <img src="icons/star_empty.png" class="star" id="star-1">
                <img src="icons/star_empty.png" class="star" id="star-2">
            </div>
        </div>
        <div id="problem-note" class="problem-note hidden">
            <div class="pin"></div>
            <p id="problem-note-text"> 转驻注 注...</p>
        </div>
        <div id="chat-window" class="chat-window"></div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="转/  拽/ 转 转砖转..." autocomplete="off">
            <button id="mic-btn" class="mic-btn"></button>
            <button id="send-button">砖/</button>
        </div>
    </div>
  </div>

  <script>
    // 1. 专转 转转 
    const NEW_GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwFRtc_gmtP4qQ0Coo9LE2VFQjHswKMukBjf72GonV6bxcSk9hEfSBeScA5qze5iItoog/exec';

    // 2. 驻拽爪转 砖转 转
    window.sendDataToGoogleSheet = function(logData, userId) {
        let currentLevel = "General";
        try {
             // 住 砖祝 转 专  爪专 
             if (window.bot && window.bot.currentProblem) {
                currentLevel = window.bot.currentProblem.level || "General";
            }
        } catch (e) { console.log("Level error:", e); }

        const dataToSend = { logData: logData, userId: userId, level: currentLevel };

        fetch(NEW_GOOGLE_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSend)
        }).then(r => console.log('Data sent')).catch(e => console.error('Error:', e));
    };

    // 3. 驻注转 拽专驻
    const myMicBtn = document.getElementById('mic-btn');
    const myInputField = document.getElementById('user-input');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'he-IL'; 
        recognition.continuous = false; 

        myMicBtn.addEventListener('click', () => {
            if (myMicBtn.classList.contains('recording')) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        recognition.onstart = () => myMicBtn.classList.add('recording');
        recognition.onend = () => myMicBtn.classList.remove('recording');
        
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            myInputField.value = transcript; 
        };
    } else {
        myMicBtn.style.display = 'none'; // 住转专  驻驻  转
    }
  </script>

  <script src="script.js"></script>
</body>
</html>